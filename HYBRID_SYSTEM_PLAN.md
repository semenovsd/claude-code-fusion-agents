# План создания гибридной системы субагентов

## Анализ лучших практик

### Из lst97 (claude-code-sub-agents):
✅ **agent-organizer** - интеллектуальный анализ проектов, автоматический выбор команды
✅ Интеграция MCP (Context7, Sequential Thinking)
✅ Реальные метрики производительности
✅ Протоколы коммуникации между агентами
✅ Качественные системные промпты

### Из VoltAgent (awesome-claude-code-subagents):
✅ Отличная категоризация (10 категорий)
✅ Широкий охват агентов (100+)
✅ Production-ready подход
✅ Четкие чек-листы и best practices
✅ Структурированные протоколы коммуникации

### Из zhsama (claude-sub-agent):
✅ Структурированный workflow (Planning → Development → Validation)
✅ Quality gates на каждом этапе
✅ Специализированные агенты для каждого этапа (spec-analyst, spec-planner, etc.)
✅ Итеративное улучшение
✅ Детальные артефакты

---

## Архитектура гибридной системы

### 1. Адаптивная система оркестрации

#### Уровень 1: Простые задачи (Simple Task Router)
- **Триггер:** Односложные запросы, правки в одном файле, простые рефакторинги
- **Модель:** haiku
- **Токены:** <500
- **Время:** <2 минуты
- **Логика:** Прямое выполнение без оркестрации

#### Уровень 2: Средние задачи (Standard Workflow)
- **Триггер:** Задачи требующие 2-3 агента, новые фичи, рефакторинг модуля
- **Модель:** haiku для оркестрации, sonnet для специалистов
- **Токены:** 2000-5000
- **Время:** 5-15 минут
- **Логика:** Упрощенная оркестрация с 2-3 агентами

#### Уровень 3: Сложные задачи (Full Pipeline)
- **Триггер:** Новые проекты, крупные рефакторинги, архитектурные изменения
- **Модель:** haiku для оркестрации, sonnet для специалистов
- **Токены:** 10000-50000+
- **Время:** 30-120 минут
- **Логика:** Полный pipeline с quality gates

---

## Структура проекта

```
hybrid-subagents-system/
├── agents/
│   ├── orchestration/
│   │   ├── adaptive-orchestrator.md          # Главный адаптивный оркестратор
│   │   ├── task-complexity-analyzer.md       # Анализатор сложности задач
│   │   └── workflow-coordinator.md           # Координатор workflow
│   ├── planning/
│   │   ├── requirements-analyst.md           # Анализ требований (улучшенный spec-analyst)
│   │   ├── technical-planner.md              # Техническое планирование (улучшенный spec-planner)
│   │   └── business-analyst.md               # Бизнес-анализ
│   ├── development/
│   │   ├── backend-architect.md              # Из lst97 (лучший)
│   │   ├── frontend-developer.md             # Из VoltAgent (лучший)
│   │   ├── full-stack-developer.md           # Комбинированный
│   │   └── [language specialists]             # Из 0xfurai (компактные)
│   ├── quality/
│   │   ├── code-reviewer.md                  # Из lst97
│   │   ├── test-automator.md                  # Из lst97
│   │   ├── security-auditor.md                # Из VoltAgent
│   │   └── quality-validator.md               # Из zhsama
│   └── [other categories]                     # Из VoltAgent
├── workflows/
│   ├── simple-workflow.md                    # Простой workflow
│   ├── standard-workflow.md                  # Стандартный workflow
│   └── full-pipeline.md                      # Полный pipeline
├── quality-gates/
│   ├── planning-gate.md
│   ├── development-gate.md
│   └── validation-gate.md
├── docs/
│   ├── README.md
│   ├── ARCHITECTURE.md
│   ├── USAGE_GUIDE.md
│   └── BEST_PRACTICES.md
└── CLAUDE.md                                  # Главный файл для проектов
```

---

## Ключевые компоненты

### 1. Adaptive Orchestrator (Главный оркестратор)

**Объединяет:**
- Интеллектуальный анализ из lst97
- Адаптивность под сложность задачи
- Структурированный workflow из zhsama
- Широкий каталог агентов из VoltAgent

**Функции:**
- Анализ сложности задачи
- Выбор уровня оркестрации
- Формирование команды агентов
- Управление workflow
- Quality gates

### 2. Task Complexity Analyzer

**Определяет:**
- Простые задачи: правки, рефакторинг одного файла
- Средние задачи: новые фичи, рефакторинг модуля
- Сложные задачи: новые проекты, архитектурные изменения

**Критерии:**
- Количество затронутых файлов
- Необходимость планирования
- Необходимость тестирования
- Необходимость архитектурных решений

### 3. Requirements Analyst (улучшенный)

**Объединяет:**
- Детальность из zhsama
- Структурированность из VoltAgent
- Интеграцию MCP из lst97

**Улучшения:**
- Использование Context7 для best practices
- Sequential Thinking для сложного анализа
- Адаптация под сложность задачи

### 4. Technical Planner (улучшенный)

**Объединяет:**
- Детальность планирования из zhsama
- Практичность из lst97
- Структурированность из VoltAgent

**Улучшения:**
- Оптимизация для разных уровней сложности
- Интеграция с оркестратором
- Автоматическое определение зависимостей

---

## Система Quality Gates

### Gate 1: Planning Quality (только для сложных задач)
- Требования: >95% полноты
- Архитектура: валидация feasibility
- План: детализация задач

### Gate 2: Development Quality
- Качество кода: >85%
- Покрытие тестами: >80%
- Безопасность: сканирование уязвимостей

### Gate 3: Validation Quality
- Code review: пройден
- Тесты: все проходят
- Документация: полная

---

## Оптимизация токенов

### Стратегии:

1. **Адаптивные промпты:**
   - Простые задачи: компактные промпты (~50 строк)
   - Средние задачи: стандартные промпты (~100 строк)
   - Сложные задачи: детальные промпты (~200 строк)

2. **Выбор модели:**
   - haiku: оркестрация, простые задачи
   - sonnet: стандартные задачи, специалисты
   - opus: только для критических задач

3. **Кэширование контекста:**
   - Переиспользование анализа проекта
   - Инкрементальное обновление контекста

4. **Параллельное выполнение:**
   - Независимые задачи выполняются параллельно
   - Синхронизация только при необходимости

---

## Full-Stack фокус

### Workflow для Full-Stack разработки:

1. **Planning Phase:**
   - requirements-analyst: анализ требований
   - technical-planner: планирование задач
   - backend-architect: проектирование API
   - frontend-developer: проектирование UI

2. **Development Phase:**
   - backend-architect: реализация API
   - frontend-developer: реализация UI
   - test-automator: написание тестов

3. **Validation Phase:**
   - code-reviewer: код-ревью
   - security-auditor: проверка безопасности
   - quality-validator: финальная валидация

---

## Интеллектуальное планирование

### Процесс от постановки задачи до детализированного плана:

1. **Task Complexity Analyzer:** Определение сложности
2. **Requirements Analyst:** Уточнение требований (для сложных задач)
3. **Business Analyst:** Бизнес-контекст (для сложных задач)
4. **Technical Planner:** Детализированный план
5. **Adaptive Orchestrator:** Формирование команды и workflow

---

## Следующие шаги

1. ✅ Создать структуру проекта
2. ⏳ Создать Adaptive Orchestrator
3. ⏳ Создать Task Complexity Analyzer
4. ⏳ Создать улучшенных агентов планирования
5. ⏳ Создать специализированных агентов (лучшие из всех)
6. ⏳ Создать систему quality gates
7. ⏳ Оптимизировать промпты для разных уровней
8. ⏳ Создать документацию
9. ⏳ Протестировать работоспособность
